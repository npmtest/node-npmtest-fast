<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-fast/node_modules/fast/lib/fast_client.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-fast">npmtest-fast (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-fast/node_modules/fast/lib/fast_client.js</span></h1>
    <h2>
        
        Statements: <span class="metric">2.09% <small>(6 / 287)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 67)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 31)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">2.09% <small>(6 / 287)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-fast/node_modules/fast/lib/</a> &#187; fast_client.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
&nbsp;
/*
 * Copyright (c) 2016, Joyent, Inc.
 */
&nbsp;
/*
 * lib/fast_client.js: public node-fast client interface
 */
&nbsp;
var mod_assertplus = require('assert-plus');
var mod_dtrace = require('dtrace-provider');
var mod_events = require('events');
var mod_microtime = require('microtime');
<span class="cstat-no" title="statement not covered" >var mod_util = require('util');</span>
<span class="cstat-no" title="statement not covered" >var VError = require('verror');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >var mod_protocol = require('./fast_protocol');</span>
<span class="cstat-no" title="statement not covered" >var mod_client_request = require('./fast_client_request');</span>
<span class="cstat-no" title="statement not covered" >var mod_subr = require('./subr');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >exports.FastClient = FastClient;</span>
&nbsp;
/*
 * There's one DTrace provider for all clients using this copy of this module.
 */
<span class="cstat-no" title="statement not covered" >var fastClientProvider = null;</span>
&nbsp;
/*
 * We have one counter for the number of clients in the process.  Note that this
 * is a true JavaScript global, so that different copies of this module
 * (presumably at different versions) will still end up with unique client ids.
 */
/* jsl:declare fastNclients */
<span class="cstat-no" title="statement not covered" >fastNclients = 0;</span>
&nbsp;
&nbsp;
/*
 * A FastClient is an object used to make RPC requests to a remote Fast server.
 * This client does not manage the connection to the remote server.  That's the
 * responsibility of the caller.
 *
 * Named arguments:
 *
 *     log		bunyan-style logger
 *
 *     nRecentRequests	count of recent requests to keep track of (for
 *     			debugging)
 *
 *     transport	usually a socket connected to the remote server, but
 *     			this could be any data-mode duplex stream.  This client
 *     			will write messages to the transport and parse responses
 *     			from the transport.  This client listens for 'error'
 *     			events and end-of-stream only so that it can report
 *     			request failures.  The caller is also expected to listen
 *     			for these errors and handle reconnection appropriately.
 *
 * On 'error', the caller should assume that the current connection to the
 * server is in an undefined state and should not be used any more.  Any
 * in-flight RPC will be terminated gracefully (i.e., with an "error" or "end"
 * event).
 */
<span class="fstat-no" title="function not covered" >function FastClient(args)</span>
{
<span class="cstat-no" title="statement not covered" >	var self = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(args, 'args');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(args.log, 'args.log');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.number(args.nRecentRequests, 'args.nRecentRequests');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(args.transport, 'args.transport');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_log = args.log;</span>
<span class="cstat-no" title="statement not covered" >	this.fc_transport = args.transport;</span>
<span class="cstat-no" title="statement not covered" >	this.fc_nrecent = args.nRecentRequests;</span>
&nbsp;
	/* RPC and protocol state */
<span class="cstat-no" title="statement not covered" >	this.fc_pending = {}; </span>		/* pending requests */
<span class="cstat-no" title="statement not covered" >	this.fc_abandoned = {};	</span>	/* abandoned, outstanding requests */
<span class="cstat-no" title="statement not covered" >	this.fc_nrpc_started = 0;	</span>/* requests issued */
<span class="cstat-no" title="statement not covered" >	this.fc_nrpc_done = 0;	</span>	/* requests completed */
<span class="cstat-no" title="statement not covered" >	this.fc_recentrpc = [];	</span>	/* recently completed requests */
<span class="cstat-no" title="statement not covered" >	this.fc_error = null;	</span>	/* first fatal error, if any */
<span class="cstat-no" title="statement not covered" >	this.fc_nerrors = 0;	</span>	/* count of fatal errors */
<span class="cstat-no" title="statement not covered" >	this.fc_rqidalloc = new mod_subr.IdAllocator({</span>
	    'min': 1,
	    'max': mod_protocol.FP_MSGID_MAX,
	    'isAllocated': <span class="fstat-no" title="function not covered" >function isReqIdAllocated(id) {</span>
<span class="cstat-no" title="statement not covered" >		return (self.fc_pending.hasOwnProperty(id) ||</span>
		    self.fc_abandoned.hasOwnProperty(id));
	    }
	});
&nbsp;
	/* transport and message helper objects */
<span class="cstat-no" title="statement not covered" >	this.fc_transport_onerr = null;	</span>/* error listener */
<span class="cstat-no" title="statement not covered" >	this.fc_msgencoder = new mod_protocol.FastMessageEncoder();</span>
<span class="cstat-no" title="statement not covered" >	this.fc_msgdecoder = new mod_protocol.FastMessageDecoder();</span>
&nbsp;
	/* transport state */
<span class="cstat-no" title="statement not covered" >	this.fc_detached = false;	</span> /* caller detached us */
<span class="cstat-no" title="statement not covered" >	this.fc_transport_ended = false; </span>/* transport detached us */
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (fastClientProvider === null) {</span>
<span class="cstat-no" title="statement not covered" >		fastClientProvider = fastClientProviderInit();</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(fastClientProvider);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_dtid = ++fastNclients;</span>
<span class="cstat-no" title="statement not covered" >	this.fc_dtp = fastClientProvider;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_events.EventEmitter.call(this);</span>
<span class="cstat-no" title="statement not covered" >	this.attach();</span>
}
&nbsp;
<span class="cstat-no" title="statement not covered" >mod_util.inherits(FastClient, mod_events.EventEmitter);</span>
&nbsp;
/*
 * [public] Initiate an RPC request.  Named parameters include:
 *
 *     rpcmethod	(string)	name of the RPC method to invoke
 *
 *     rpcargs		(object)	values of arguments passed to the RPC
 *
 *     timeout (optional number)	milliseconds after which to abandon the
 *     					request if no response has been received
 *
 *     log        (optional log)	bunyan-style logger
 *
 *     ignoreNullValues			allow null values to be received from
 *     (optional boolean)		the server and drop them.  This is used
 *     					for legacy servers that incorrectly sent
 *     					null values.  If this is not specified
 *     					and a null value is received, this is
 *     					treated as a protocol error.
 *
 * The semantics of "rpcmethod" and "rpcargs" are defined by the server.
 *
 * If "log" is not provided, then this request uses a child of the client-level
 * logger.
 *
 * The return value is an object-mode readable stream that emits zero or more
 * messages from the server.  As with other readable streams, "end" denotes
 * successful completion, and "error" denotes unsuccessful completion.  This
 * stream does not support flow control, so the server must be trusted, and the
 * caller must avoid making requests that return large amounts of data faster
 * than the caller can process it.  Additionally, the stream is already reading
 * when the caller gets it, so there's no need to call read(0) to kick off the
 * RPC.
 *
 * See rpcBufferAndCallback() for an interface that buffers incoming data and
 * invokes a callback upon completion.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.rpc = <span class="fstat-no" title="function not covered" >function (args)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var msgid, log, request, message;</span>
<span class="cstat-no" title="statement not covered" >	var timeoutms = null;</span>
<span class="cstat-no" title="statement not covered" >	var self = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(args, 'args');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.string(args.rpcmethod, 'method.rpcmethod');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.array(args.rpcargs, 'args.rpcargs');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.optionalNumber(args.timeout, 'args.timeout');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.optionalObject(args.log, 'args.log');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.optionalBool(args.ignoreNullValues,</span>
	    'args.ignoreNullValues');
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (typeof (args.timeout) == 'number') {</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(args.timeout &gt; 0, 'args.timeout &gt; 0');</span>
<span class="cstat-no" title="statement not covered" >		timeoutms = args.timeout;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	msgid = this.allocMessageId();</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(!this.fc_pending.hasOwnProperty(msgid));</span>
<span class="cstat-no" title="statement not covered" >	log = args.log ? args.log : this.fc_log;</span>
<span class="cstat-no" title="statement not covered" >	request = new mod_client_request.FastClientRequest({</span>
	    'client': this,
	    'msgid': msgid,
	    'rpcmethod': args.rpcmethod,
	    'rpcargs': args.rpcargs,
	    'ignoreNullValues': args.ignoreNullValues || false,
	    'log': log.child({
		'component': 'FastClientRequest',
		'msgid': msgid,
		'rpcmethod': args.rpcmethod
	    })
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_pending[msgid] = request;</span>
<span class="cstat-no" title="statement not covered" >	this.fc_nrpc_started++;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (this.fc_error !== null || this.fc_detached ||</span>
	    this.fc_transport_ended) {
<span class="cstat-no" title="statement not covered" >		this.fc_log.debug('skipping new request (transport detached)');</span>
<span class="cstat-no" title="statement not covered" >		request.frq_skip = true;</span>
<span class="cstat-no" title="statement not covered" >		this.requestFail(request, new VError({</span>
		    'name': 'FastTransportError'
		}, 'transport detached'));
<span class="cstat-no" title="statement not covered" >		return (request);</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	message = {</span>
	    'msgid': msgid,
	    'status': mod_protocol.FP_STATUS_DATA,
	    'data': {
		'm': {
		    'uts': mod_microtime.now(),
		    'name': args.rpcmethod
		},
		'd': args.rpcargs
	    }
	};
&nbsp;
<span class="cstat-no" title="statement not covered" >	request.frq_log.debug({</span>
	    'rpcargs': args.rpcargs,
	    'timeoutms': timeoutms
	}, 'rpc %s: entered', args.rpcmethod);
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_dtp.fire('rpc-start', <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >	    return ([</span>
		self.fc_dtid,
		request.frq_msgid,
		args.rpcmethod,
		{
		    'rpcargs': args.rpcargs,
		    'timeout': timeoutms
		}
	    ]);
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_log.trace(message, 'outgoing message');</span>
<span class="cstat-no" title="statement not covered" >	this.fc_msgencoder.write(message);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (timeoutms !== null) {</span>
<span class="cstat-no" title="statement not covered" >		request.frq_timeout = setTimeout(<span class="fstat-no" title="function not covered" >function onRpcTimeout() {</span></span>
<span class="cstat-no" title="statement not covered" >			self.requestAbandon(request, new VError({</span>
			    'name': 'TimeoutError',
			    'info': {
				'timeout': timeoutms
			    }
			}, 'timed out after %d milliseconds', timeoutms));
		}, timeoutms);
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	return (request);</span>
};
&nbsp;
/*
 * Make an RPC request just like rpc(), but buffer incoming data messages until
 * the request is complete and invoke "callback" as callback(err, data, ndata)
 * when the request is complete.  In the callback:
 *
 *     "err" is the error, if any
 *
 *     "data" is an array of data objects returned with the RPC
 *     (up to "maxObjectsToBuffer" objects)
 *
 *     "ndata" is a non-negative integer describing how many data objects were
 *     received.  If "ndata" is larger than "data.length", then messages were
 *     dropped because maxObjectsToBuffer was too small.
 *
 * Note that "data" will always be an array and may contain messages even if
 * "err" is present.  Similarly, "ndata" will always be a non-negative integer.
 *
 * This function takes all of the named arguments that rpc() takes, plus the
 * following required argument:
 *
 *     maxObjectsToBuffer	the maximum number of data messages to buffer.
 *     				This allows callers to use this interface to
 *     				make an RPC call that they expect may only
 *     				produce a small number of data messages and know
 *     				that a bounded amount of memory will be used,
 *     				even if the server returns more than the
 *     				expected number of messages.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.rpcBufferAndCallback = <span class="fstat-no" title="function not covered" >function (args, callback)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var maxbuffer, request, data, ndata, done;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(args, 'args');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.func(callback, 'callback');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.number(args.maxObjectsToBuffer,</span>
	    'args.maxObjectsToBuffer');
<span class="cstat-no" title="statement not covered" >	maxbuffer = args.maxObjectsToBuffer;</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(maxbuffer &gt;= 0);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	data = [];</span>
<span class="cstat-no" title="statement not covered" >	ndata = 0;</span>
<span class="cstat-no" title="statement not covered" >	done = false;</span>
<span class="cstat-no" title="statement not covered" >	request = this.rpc(args);</span>
<span class="cstat-no" title="statement not covered" >	request.on('data', <span class="fstat-no" title="function not covered" >function (c) {</span></span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(!done);</span>
<span class="cstat-no" title="statement not covered" >		ndata++;</span>
<span class="cstat-no" title="statement not covered" >		if (data.length &lt; maxbuffer) {</span>
<span class="cstat-no" title="statement not covered" >			data.push(c);</span>
		}
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	request.on('error', <span class="fstat-no" title="function not covered" >function (err) {</span></span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(!done);</span>
<span class="cstat-no" title="statement not covered" >		done = true;</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(data.length &lt;= ndata);</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(data.length &lt;= maxbuffer);</span>
<span class="cstat-no" title="statement not covered" >		callback(err, data, ndata);</span>
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	request.on('end', <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(!done);</span>
<span class="cstat-no" title="statement not covered" >		done = true;</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(data.length &lt;= ndata);</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(data.length &lt;= maxbuffer);</span>
<span class="cstat-no" title="statement not covered" >		callback(null, data, ndata);</span>
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	return (request);</span>
};
&nbsp;
/*
 * Disconnect entirely from the underlying transport.  Do not read from it or
 * write to it and remove any event handlers.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.detach = <span class="fstat-no" title="function not covered" >function ()</span></span>
{
<span class="cstat-no" title="statement not covered" >	if (this.fc_detached) {</span>
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_detached = true;</span>
<span class="cstat-no" title="statement not covered" >	this.fc_transport.removeListener('error', this.fc_transport_onerr);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_transport.unpipe(this.fc_msgdecoder);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_msgencoder.unpipe(this.fc_transport);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.requestAbandonAll(new VError({</span>
	    'name': 'FastTransportError'
	}, 'client detached from transport'));
};
&nbsp;
/*
 * Public methods for exposing debugging data over kang.
 *
 * Over kang, we expose objects of types:
 *
 *     fastclient	  describes a single FastClient, including basic
 *			  activity stats, any fatal error, and so on.
 *
 *     fastrequest	  describes a request that's currently outstanding,
 *			  including which connection received it, how long it's
 *			  been running, and what state it's in
 *
 * We do not provide a kang entry point for stats because we expect that there
 * will be many FastClients in most kang components and they will aggregate up
 * statistics from individual "fastclient" objects as desired.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.kangListTypes = <span class="fstat-no" title="function not covered" >function ()</span></span>
{
<span class="cstat-no" title="statement not covered" >	return ([ 'fastclient', 'fastrequest' ]);</span>
};
&nbsp;
<span class="cstat-no" title="statement not covered" >FastClient.prototype.kangListObjects = <span class="fstat-no" title="function not covered" >function (type)</span></span>
{
<span class="cstat-no" title="statement not covered" >	if (type == 'fastclient') {</span>
<span class="cstat-no" title="statement not covered" >		return ([ this.fc_dtid ]);</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.equal(type, 'fastrequest');</span>
<span class="cstat-no" title="statement not covered" >	return (Object.keys(this.fc_pending).concat(</span>
	    Object.keys(this.fc_abandoned)));
};
&nbsp;
<span class="cstat-no" title="statement not covered" >FastClient.prototype.kangGetObject = <span class="fstat-no" title="function not covered" >function (type, id)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var rv, req;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (type == 'fastclient') {</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.equal(id, this.fc_dtid);</span>
<span class="cstat-no" title="statement not covered" >		rv = {</span>
		    'id': id,
		    'nRpcStarted': this.fc_nrpc_started,
		    'nRpcDone': this.fc_nrpc_done,
		    'nErrors': this.fc_nerrors,
		    'error': this.fc_error,
		    'detached': this.fc_detached,
		    'transportEnded': this.fc_transport_ended
		};
<span class="cstat-no" title="statement not covered" >		return (rv);</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.equal(type, 'fastrequest');</span>
<span class="cstat-no" title="statement not covered" >	rv = {};</span>
<span class="cstat-no" title="statement not covered" >	rv['clientId'] = this.fc_dtid;</span>
<span class="cstat-no" title="statement not covered" >	rv['msgid'] = id;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (this.fc_pending.hasOwnProperty(id)) {</span>
<span class="cstat-no" title="statement not covered" >		req = this.fc_pending[id];</span>
	} else {
<span class="cstat-no" title="statement not covered" >		req = this.fc_abandoned[id];</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	rv['skipped'] = req.frq_skip;</span>
<span class="cstat-no" title="statement not covered" >	rv['rpcmethod'] = req.frq_rpcmethod;</span>
<span class="cstat-no" title="statement not covered" >	rv['nDataEmitted'] = req.frq_ndata;</span>
<span class="cstat-no" title="statement not covered" >	rv['nMessagesIgnored'] = req.frq_nignored;</span>
<span class="cstat-no" title="statement not covered" >	rv['error'] = req.frq_error;</span>
<span class="cstat-no" title="statement not covered" >	rv['abandoned'] = req.frq_abandoned;</span>
<span class="cstat-no" title="statement not covered" >	rv['doneGraceful'] = req.frq_done_graceful;</span>
<span class="cstat-no" title="statement not covered" >	rv['hasTimeout'] = req.frq_timeout !== null;</span>
<span class="cstat-no" title="statement not covered" >	return (rv);</span>
};
&nbsp;
/*
 * private methods
 */
&nbsp;
<span class="cstat-no" title="statement not covered" >FastClient.prototype.attach = <span class="fstat-no" title="function not covered" >function ()</span></span>
{
<span class="cstat-no" title="statement not covered" >	var self = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_transport.pipe(this.fc_msgdecoder);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_msgencoder.pipe(this.fc_transport, { 'end': false });</span>
&nbsp;
	/*
	 * It's non-idiomatic to use the "data" event because it defeats flow
	 * control.  However, this abstraction cannot support flow control
	 * anyway, but clients can already deal with this by limiting the size
	 * of responses.  Since we know our message decoder is an object-mode
	 * stream, we may as well just read objects with this handler.
	 */
<span class="cstat-no" title="statement not covered" >	this.fc_msgdecoder.on('data',</span>
<span class="fstat-no" title="function not covered" >	    function onDecoderMessage(message) {</span> <span class="cstat-no" title="statement not covered" >self.onMessage(message); </span>});
<span class="cstat-no" title="statement not covered" >	this.fc_msgdecoder.on('error',</span>
<span class="fstat-no" title="function not covered" >	    function onDecoderError(err) {</span> <span class="cstat-no" title="statement not covered" >self.fatalError(err); </span>});
&nbsp;
	/*
	 * By the nature of this abstraction, we don't own the transport.  But
	 * we still want to know when it either emits "end" or "error" so that
	 * we can know that any outstanding requests will not be completed.
	 * Some modules use "close" for this, but transports are not required to
	 * emit that event.  They should emit one of these two.  We listen for
	 * "end" on the message decoder rather than the transport to deal with
	 * the fact that there may be queueing of data in between them.
	 */
<span class="cstat-no" title="statement not covered" >	this.fc_msgdecoder.on('end', <span class="fstat-no" title="function not covered" >function onTransportEnd() {</span></span>
<span class="cstat-no" title="statement not covered" >		var err;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		self.fc_transport_ended = true;</span>
&nbsp;
		/*
		 * There's no problem with seeing end-of-stream as long as we
		 * have no requests pending and are not asked to make any more
		 * requests.  Remember, the caller is separately responsible for
		 * detecting this case for the purpose of reconnection, if
		 * desired.
		 */
<span class="cstat-no" title="statement not covered" >		if (self.fc_nrpc_started &gt; self.fc_nrpc_done) {</span>
<span class="cstat-no" title="statement not covered" >			err = new VError({</span>
			    'name': 'FastProtocolError'
			}, 'unexpected end of transport stream');
<span class="cstat-no" title="statement not covered" >			self.fatalError(err);</span>
		}
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_transport_onerr = <span class="fstat-no" title="function not covered" >function onTransportError(err) {</span></span>
<span class="cstat-no" title="statement not covered" >		self.fatalError(new VError({</span>
		    'name': 'FastTransportError',
		    'cause': err
		}, 'unexpected error on transport'));
	};
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_transport.on('error', this.fc_transport_onerr);</span>
};
&nbsp;
/*
 * Return the next message id.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.allocMessageId = <span class="fstat-no" title="function not covered" >function ()</span></span>
{
<span class="cstat-no" title="statement not covered" >	return (this.fc_rqidalloc.alloc());</span>
};
&nbsp;
/*
 * Record an error that's fatal to this client.  We emit the first one and
 * abandon all outstanding requests.  If we see more than one, we simply log and
 * count subsequent ones.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.fatalError = <span class="fstat-no" title="function not covered" >function (err)</span></span>
{
<span class="cstat-no" title="statement not covered" >	this.fc_log.warn(err);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_nerrors++;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (this.fc_error !== null) {</span>
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_error = err;</span>
<span class="cstat-no" title="statement not covered" >	this.emit('error', err);</span>
<span class="cstat-no" title="statement not covered" >	this.requestAbandonAll(err);</span>
};
&nbsp;
/*
 * Abandon all pending requests, as with requestAbandon(request, error).
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestAbandonAll = <span class="fstat-no" title="function not covered" >function (error)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var msgid;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	for (msgid in this.fc_pending) {</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(</span>
		    this.requestIsPending(this.fc_pending[msgid]));
<span class="cstat-no" title="statement not covered" >		this.requestAbandon(this.fc_pending[msgid], error);</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(!this.fc_pending.hasOwnProperty(msgid));</span>
	}
};
&nbsp;
/*
 * Abandon the given request with an error indicating the request was abandoned.
 * If "error" is provided, then the given error will be provided as the cause of
 * the abandon error.  If the request has already completed in any way
 * (including having been previously abandoned), this will do nothing.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestAbandon = <span class="fstat-no" title="function not covered" >function (request, error)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var msgid;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (!this.requestIsPending(request)) {</span>
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(error, 'error');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	msgid = request.frq_msgid;</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(this.fc_pending[msgid] == request);</span>
<span class="cstat-no" title="statement not covered" >	request.frq_abandoned = true;</span>
&nbsp;
	/*
	 * The history of cancellation in node-fast is somewhat complicated.
	 * Early versions did not support cancellation of in-flight requests.
	 * Cancellation was added, but old servers would interpret the
	 * cancellation message as a new request for the same RPC, which is
	 * extremely dangerous.  (Usually, the arguments would be invalid, but
	 * that's only the best-case outcome.)  We could try to avoid this by
	 * avoiding specifying the RPC method name in the cancellation request.
	 * Since the protocol was never well-documented, the correctness of this
	 * approach is mainly determined by what other servers do with it.
	 * Unfortunately, old servers are likely to handle it as an RPC method
	 * of some kind, which triggers an unrelated bug: if old servers
	 * received a request for a method that's not registered, they just
	 * hang on it, resulting in a resource leak.
	 *
	 * Things are a little better on more modern versions of the fast
	 * server, where if you send a cancellation request and the RPC is not
	 * yet complete when the server processes it, then the server may stop
	 * processing the RPC and send back an acknowledgment of sorts.
	 * However, that doesn't mean the request did not complete, since the
	 * implementation may not have responded to the cancellation.  And more
	 * seriously, if the RPC isn't running, the server won't send back
	 * anything, so we don't know whether we need to expect something or
	 * not.
	 *
	 * To summarize: if we were to send a cancellation request, we would not
	 * know whether to expect a response, and it's possible that we would
	 * inadvertently invoke the same RPC again (which could be very
	 * destructive) or leak resources in the remote server.  For now, we
	 * punt and declare that request abandonment is purely a client-side
	 * convenience that directs the client to stop doing anything with
	 * messages for this request.  We won't actually ask the server to stop
	 * doing anything.
	 */
<span class="cstat-no" title="statement not covered" >	this.fc_abandoned[request.frq_msgid] = request;</span>
<span class="cstat-no" title="statement not covered" >	this.requestFail(request, error);</span>
};
&nbsp;
/*
 * Mark the given request as completed with the specified error.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestFail = <span class="fstat-no" title="function not covered" >function (request, error)</span></span>
{
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(request.frq_error === null);</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(error);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	request.frq_error = new VError({</span>
	    'name': 'FastRequestError',
	    'cause': error,
	    'info': {
		'rpcMsgid': request.frq_msgid,
		'rpcMethod': request.frq_rpcmethod
	    }
	}, 'request failed');
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.requestComplete(request);</span>
&nbsp;
	/*
	 * We may be called in the context of a user action (e.g., if they
	 * issued a request while the transport was disconnected, or if they're
	 * abandoning a request).  Defer the 'error' event so they don't have to
	 * deal with it being emitted synchronously during the execution of that
	 * action.
	 */
<span class="cstat-no" title="statement not covered" >	setImmediate(<span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >		request.emit('error', request.frq_error);</span>
	});
};
&nbsp;
/*
 * Mark the given request as completed.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestComplete = <span class="fstat-no" title="function not covered" >function (request)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var msgid;</span>
<span class="cstat-no" title="statement not covered" >	var self = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (request.frq_timeout !== null) {</span>
<span class="cstat-no" title="statement not covered" >		clearTimeout(request.frq_timeout);</span>
<span class="cstat-no" title="statement not covered" >		request.frq_timeout = null;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_dtp.fire('rpc-done', <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >		var result, err;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		result = {};</span>
<span class="cstat-no" title="statement not covered" >		if (request.frq_error !== null) {</span>
<span class="cstat-no" title="statement not covered" >			err = VError.cause(request.frq_error);</span>
<span class="cstat-no" title="statement not covered" >			result['error'] = {</span>
			    'name': err ? err.name : '?',
			    'message': err ? err.message : '?'
			};
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		return ([</span>
		    self.fc_dtid,
		    request.frq_msgid,
		    result
		]);
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (request.frq_error !== null) {</span>
<span class="cstat-no" title="statement not covered" >		request.frq_log.debug(request.frq_error, 'rpc %s: failed',</span>
		    request.frq_rpcmethod);
	} else {
<span class="cstat-no" title="statement not covered" >		request.frq_log.debug('rpc %s: done', request.frq_rpcmethod);</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	msgid = request.frq_msgid;</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(!this.requestIsPending(request));</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(this.fc_pending[msgid] == request);</span>
<span class="cstat-no" title="statement not covered" >	delete (this.fc_pending[msgid]);</span>
<span class="cstat-no" title="statement not covered" >	this.fc_nrpc_done++;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_recentrpc.push(request);</span>
<span class="cstat-no" title="statement not covered" >	if (this.fc_recentrpc.length &gt; this.fc_nrecent) {</span>
<span class="cstat-no" title="statement not covered" >		this.fc_recentrpc.shift();</span>
	}
};
&nbsp;
<span class="cstat-no" title="statement not covered" >FastClient.prototype.onMessage = <span class="fstat-no" title="function not covered" >function (message)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var request, abandoned, cause;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	this.fc_log.trace(message, 'incoming message');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.number(message.msgid,</span>
	    'decoder provided message with no msgid');
<span class="cstat-no" title="statement not covered" >	if (this.fc_pending.hasOwnProperty(message.msgid)) {</span>
<span class="cstat-no" title="statement not covered" >		request = this.fc_pending[message.msgid];</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(!request.frq_abandoned);</span>
<span class="cstat-no" title="statement not covered" >		abandoned = false;</span>
	} else <span class="cstat-no" title="statement not covered" >if (this.fc_abandoned.hasOwnProperty(message.msgid)) {</span>
<span class="cstat-no" title="statement not covered" >		request = this.fc_abandoned[message.msgid];</span>
<span class="cstat-no" title="statement not covered" >		mod_assertplus.ok(request.frq_abandoned);</span>
<span class="cstat-no" title="statement not covered" >		abandoned = true;</span>
	} else {
<span class="cstat-no" title="statement not covered" >		this.fatalError(new VError({</span>
		    'name': 'FastProtocolError',
		    'info': {
			'fastReason': 'unknown_msgid',
			'fastMsgid': message.msgid
		    }
		}, 'fast protocol: received message with unknown msgid %d',
		    message.msgid));
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(!request.frq_done_graceful);</span>
<span class="cstat-no" title="statement not covered" >	request.frq_last = message;</span>
&nbsp;
	/*
	 * "end" messages are always meaningful because they allow us to clean
	 * up both normal and abandoned requests.
	 */
<span class="cstat-no" title="statement not covered" >	if (message.status == mod_protocol.FP_STATUS_END) {</span>
<span class="cstat-no" title="statement not covered" >		if (abandoned) {</span>
<span class="cstat-no" title="statement not covered" >			request.frq_log.debug('cleaning up abandoned request');</span>
<span class="cstat-no" title="statement not covered" >			delete (this.fc_abandoned[request.frq_msgid]);</span>
		} else {
			/*
			 * Although seldom used, it's technically allowed for
			 * END messages to contain data.
			 */
<span class="cstat-no" title="statement not covered" >			if (this.requestEmitData(request, message)) {</span>
<span class="cstat-no" title="statement not covered" >				request.frq_done_graceful = true;</span>
<span class="cstat-no" title="statement not covered" >				this.requestComplete(request);</span>
<span class="cstat-no" title="statement not covered" >				request.end();</span>
			}
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
	/*
	 * If the request was abandoned, then ignore all other messages.
	 */
<span class="cstat-no" title="statement not covered" >	if (abandoned) {</span>
<span class="cstat-no" title="statement not covered" >		request.frq_log.trace(</span>
		    'ignoring incoming message (request abandoned)');
<span class="cstat-no" title="statement not covered" >		request.frq_nignored++;</span>
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
	/*
	 * The only reasons we can have an error are because we never sent the
	 * request out at all (which can never result in us getting here), we
	 * abandoned the request (which we handled above), or the server already
	 * sent us an error (in which case we also shouldn't be able to get
	 * here).
	 */
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(request.frq_error === null);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (message.status == mod_protocol.FP_STATUS_DATA) {</span>
<span class="cstat-no" title="statement not covered" >		request.frq_ndata++;</span>
<span class="cstat-no" title="statement not covered" >		this.requestEmitData(request, message);</span>
<span class="cstat-no" title="statement not covered" >		return;</span>
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.equal(message.status, mod_protocol.FP_STATUS_ERROR,</span>
	    'decoder emitted message with invalid status');
<span class="cstat-no" title="statement not covered" >	cause = new VError({</span>
	    'name': message.data.d.name,
	    'info': message.data.d.info
	}, '%s', message.data.d.message);
<span class="cstat-no" title="statement not covered" >	if (message.data.d.stack) {</span>
<span class="cstat-no" title="statement not covered" >		cause.stack = message.data.d.stack;</span>
	}
&nbsp;
	/*
	 * "context" and "ase_errors" are reconstituted for historical reasons.
	 * There's a similar note in lib/fast_server.js.
	 */
<span class="cstat-no" title="statement not covered" >	cause.context = message.data.d.context;</span>
<span class="cstat-no" title="statement not covered" >	cause.ase_errors = message.data.d.ase_errors;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	request.frq_done_graceful = true;</span>
<span class="cstat-no" title="statement not covered" >	this.requestFail(request, new VError({</span>
	    'name': 'FastServerError',
	    'cause': cause
	}, 'server error'));
};
&nbsp;
/*
 * Emits data contained in "message".  Returns true if there was no problem
 * processing this data.  If there was an issue, then the request will be
 * abandoned.
 */
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestEmitData = <span class="fstat-no" title="function not covered" >function (request, message)</span></span>
{
<span class="cstat-no" title="statement not covered" >	var i, d;</span>
<span class="cstat-no" title="statement not covered" >	var self = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(this.requestIsPending(request));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	for (i = 0; i &lt; message.data.d.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >		d = message.data.d[i];</span>
<span class="cstat-no" title="statement not covered" >		if (d === null) {</span>
<span class="cstat-no" title="statement not covered" >			if (request.frq_ignorenull) {</span>
<span class="cstat-no" title="statement not covered" >				request.frq_nignored_null++;</span>
<span class="cstat-no" title="statement not covered" >				continue;</span>
			}
&nbsp;
<span class="cstat-no" title="statement not covered" >			this.requestAbandon(request, new VError({</span>
			    'name': 'FastProtocolError',
			    'info': {
				'rpcMsgid': request.frq_msgid,
				'rpcMethod': request.frq_rpcmethod,
			        'rpcMessage': message
			    }
			}, 'server sent "null" value'));
<span class="cstat-no" title="statement not covered" >			return (false);</span>
		} else {
<span class="cstat-no" title="statement not covered" >			this.fc_dtp.fire('rpc-data', <span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >			    return ([</span>
				self.fc_dtid,
				request.frq_msgid,
				d
			    ]);
			});
&nbsp;
<span class="cstat-no" title="statement not covered" >			request.push(d);</span>
		}
	}
&nbsp;
<span class="cstat-no" title="statement not covered" >	return (true);</span>
};
&nbsp;
<span class="cstat-no" title="statement not covered" >FastClient.prototype.requestIsPending = <span class="fstat-no" title="function not covered" >function (request)</span></span>
{
<span class="cstat-no" title="statement not covered" >	mod_assertplus.object(request, 'request');</span>
<span class="cstat-no" title="statement not covered" >	mod_assertplus.ok(request instanceof</span>
	    mod_client_request.FastClientRequest,
	    'request is not a FastClientRequest');
<span class="cstat-no" title="statement not covered" >	return (!request.frq_done_graceful &amp;&amp; request.frq_error === null);</span>
};
&nbsp;
&nbsp;
/*
 * Initialize the DTrace provider for the Fast client.
 */
<span class="fstat-no" title="function not covered" >function fastClientProviderInit()</span>
{
<span class="cstat-no" title="statement not covered" >	var dtp;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	dtp = mod_dtrace.createDTraceProvider('fastclient');</span>
&nbsp;
	/*
	 * The rpc-start probe provides arguments:
	 *
	 *     arg0   int	Unique identifier for this client in this
	 *     			process.
	 *     arg1   int       Message identifier (request identifier).
	 *     			This is only unique among active requests for a
	 *     			single client.  See arg2 for a unique
	 *     			identifier.
	 *     arg2   string    RPC method name
	 *     arg3   string    JSON object with properties for "rpcargs" and
	 *     			"timeout" (optionally).  Additional properties
	 *     			may be added here in the future.
	 */
<span class="cstat-no" title="statement not covered" >	dtp.addProbe('rpc-start', 'int', 'int', 'char *', 'json');</span>
&nbsp;
	/*
	 * The rpc-data probe provides arguments:
	 *
	 *     arg0   int       Same as for rpc-start.
	 *     arg1   int       Same as for rpc-start.
	 *     arg2   string    JSON object describing received data.
	 */
<span class="cstat-no" title="statement not covered" >	dtp.addProbe('rpc-data', 'int', 'int', 'json');</span>
&nbsp;
	/*
	 * The rpc-done probe provides arguments:
	 *
	 *     arg0   int       Same as for rpc-start.
	 *     arg1   int       Same as for rpc-start.
	 *     arg2   string    JSON object with properties for "error".
	 *     			Additional properties may be added here in the
	 *     			future.
	 */
<span class="cstat-no" title="statement not covered" >	dtp.addProbe('rpc-done', 'int', 'int', 'json');</span>
<span class="cstat-no" title="statement not covered" >	dtp.enable();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	return (dtp);</span>
}
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 20 2017 11:03:57 GMT+0000 (UTC)</div>
</div>
</body>
</html>
